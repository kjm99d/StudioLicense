<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Studio License Admin</title>
    <!-- Materialize CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css" rel="stylesheet">
    <!-- App styles (load after Materialize to allow overrides) -->
    <link rel="stylesheet" href="styles.css">
        <!-- Override Materialize CSS modal styles for our custom modals -->
        <style>
            /* Materialize CSS 모달 스타일 완전히 재정의 */
            .modal.studio-modal { 
                position: fixed !important; 
                top: 0 !important; 
                left: 0 !important; 
                right: 0 !important;
                bottom: 0 !important;
                width: 100% !important; 
                height: 100% !important; 
                background: rgba(0, 0, 0, 0.5) !important;
                z-index: 14000 !important; 
                display: flex !important; 
                align-items: center !important; 
                justify-content: center !important; 
                opacity: 0 !important; 
                visibility: hidden !important; 
                pointer-events: none !important; 
                transition: opacity .2s ease !important;
                max-height: none !important;
                overflow: visible !important;
                border: none !important;
                outline: none !important;
                box-shadow: none !important;
            }
            .modal.studio-modal.active { 
                opacity: 1 !important; 
                visibility: visible !important; 
                pointer-events: auto !important; 
            }
            .modal.studio-modal .modal-content { 
                background: #fff !important; 
                border-radius: 12px !important; 
                max-width: 600px !important; 
                width: 90% !important; 
                max-height: 90vh !important; 
                overflow-y: auto !important; 
                transform: translateY(-8px) scale(.98) !important; 
                opacity: .98 !important; 
                transition: transform .2s ease, opacity .2s ease, box-shadow .2s ease !important; 
                box-shadow: 0 1px 3px rgba(0,0,0,.1) !important; 
                z-index: 14001 !important;
                position: relative !important;
                border: none !important;
                outline: none !important;
                padding: 0 !important;
            }
            .modal.studio-modal.active .modal-content { 
                transform: translateY(0) scale(1) !important; 
                opacity: 1 !important; 
                box-shadow: 0 10px 15px rgba(0,0,0,.1) !important; 
            }
            .modal.studio-modal .modal-header { 
                display: flex !important; 
                justify-content: space-between !important; 
                align-items: center !important; 
                padding: 1.5rem !important; 
                border-bottom: 1px solid #e5e7eb !important; 
            }
            .modal.studio-modal .modal-body {
                padding: 1.5rem !important;
            }
            .modal.studio-modal .modal-footer { 
                display: flex !important; 
                justify-content: flex-end !important; 
                gap: .5rem !important; 
                padding: 1rem 1.5rem !important; 
                border-top: 1px solid #e5e7eb !important; 
            }
            /* 모달 닫기 버튼 스타일 */
            .modal.studio-modal .modal-close {
                background: none !important;
                border: none !important;
                padding: 0.25rem !important;
                cursor: pointer !important;
                color: #6b7280 !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                border-radius: 4px !important;
                transition: all 0.2s ease !important;
                width: 32px !important;
                height: 32px !important;
                min-width: unset !important;
                box-shadow: none !important;
                text-transform: none !important;
                line-height: 1 !important;
                margin: 0 !important;
            }
            .modal.studio-modal .modal-close:hover {
                background: #f3f4f6 !important;
                color: #111827 !important;
            }
            .modal.studio-modal .modal-close:focus {
                outline: 2px solid #3b82f6 !important;
                outline-offset: 2px !important;
            }
            /* 모달 푸터 버튼 스타일 재정의 */
            .modal.studio-modal .modal-footer button {
                display: inline-flex !important;
                align-items: center !important;
                justify-content: center !important;
                padding: 0.5rem 1.5rem !important;
                border-radius: 6px !important;
                font-size: 1rem !important;
                font-weight: 500 !important;
                cursor: pointer !important;
                transition: all 0.2s ease !important;
                text-transform: none !important;
                line-height: 1.5 !important;
                white-space: nowrap !important;
                min-width: 80px !important;
                height: auto !important;
                border: 1px solid transparent !important;
                box-shadow: none !important;
                letter-spacing: normal !important;
                vertical-align: middle !important;
            }
            .modal.studio-modal .modal-footer .btn {
                display: inline-flex !important;
                align-items: center !important;
                justify-content: center !important;
                padding: 0.5rem 1.5rem !important;
                margin: 0 !important;
            }
            .modal.studio-modal .modal-footer .btn.grey,
            .modal.studio-modal .modal-footer .btn.grey.darken-1 {
                background-color: #757575 !important;
                color: #fff !important;
                border: none !important;
            }
            .modal.studio-modal .modal-footer .btn.grey:hover,
            .modal.studio-modal .modal-footer .btn.grey.darken-1:hover {
                background-color: #616161 !important;
                box-shadow: 0 2px 4px rgba(0,0,0,0.2) !important;
            }
            .modal.studio-modal .modal-footer .btn.blue {
                background-color: #2196F3 !important;
                color: #fff !important;
                border: none !important;
            }
            .modal.studio-modal .modal-footer .btn.blue:hover {
                background-color: #1976D2 !important;
                box-shadow: 0 2px 4px rgba(0,0,0,0.2) !important;
            }
            .modal.studio-modal .modal-footer .btn.green {
                background-color: #4CAF50 !important;
                color: #fff !important;
                border: none !important;
            }
            .modal.studio-modal .modal-footer .btn.green:hover {
                background-color: #388E3C !important;
                box-shadow: 0 2px 4px rgba(0,0,0,0.2) !important;
            }
            /* Materialize의 modal-overlay 제거 */
            .modal-overlay {
                display: none !important;
            }
            /* Materialize 버튼의 모든 기본 스타일 무력화 */
            .modal.studio-modal button.btn,
            .modal.studio-modal button.btn-large,
            .modal.studio-modal button.btn-small,
            .modal.studio-modal button.btn-flat {
                text-decoration: none !important;
                color: #fff !important;
                text-align: center !important;
                letter-spacing: normal !important;
                transition: background-color 0.2s ease !important;
                cursor: pointer !important;
                border: none !important;
                border-radius: 6px !important;
                display: inline-flex !important;
                align-items: center !important;
                justify-content: center !important;
                height: auto !important;
                line-height: 1.5 !important;
                padding: 0.5rem 1.5rem !important;
                text-transform: none !important;
                vertical-align: middle !important;
                -webkit-tap-highlight-color: transparent !important;
                box-shadow: none !important;
                outline: 0 !important;
                min-width: 80px !important;
            }
        </style>
</head>
<body>
    <!-- 로그인 페이지 -->
    <div id="login-page" class="page active">
        <div class="login-container">
            <div class="login-box">
                <h1>🔐 Studio License</h1>
                <p class="subtitle">관리자 로그인</p>
                <form id="login-form" onsubmit="handleLoginForm(event)">
                    <div class="form-group">
                        <label for="username">아이디</label>
                        <input type="text" id="username" name="username" required placeholder="admin">
                    </div>
                    <div class="form-group">
                        <label for="password">비밀번호</label>
                        <input type="password" id="password" name="password" required placeholder="••••••">
                    </div>
                    <button type="submit" class="btn blue" style="width:100%">로그인</button>
                    <div id="login-error" class="error-message"></div>
                </form>
            </div>
        </div>
    </div>

    <!-- 대시보드 -->
    <div id="dashboard-page" class="page">
        <nav class="app-nav">
            <div class="nav-brand">🎫 Studio License</div>
            <div class="nav-menu">
                <a href="#" data-page="dashboard" class="nav-link active">대시보드</a>
                <a href="#" data-page="licenses" class="nav-link">라이선스</a>
                <a href="#" data-page="products" class="nav-link">제품</a>
                <a href="#" data-page="policies" class="nav-link">정책</a>
                <a href="#" data-page="files" class="nav-link">파일 서버</a>
                <a href="#" data-page="client-logs" class="nav-link">클라이언트 로그</a>
                <a href="#" data-page="admins" class="nav-link" id="admins-tab" style="display:none;">관리자</a>
                <a href="#" data-page="swagger" class="nav-link">API 문서</a>
            </div>
            <div class="nav-user">
                <div class="user-badge">
                    <svg class="user-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                    </svg>
                    <span id="user-name">Admin</span>
                </div>
                <button id="change-password-btn" class="btn btn-sm">비밀번호 변경</button>
                <button id="logout-btn" class="btn btn-sm">로그아웃</button>
            </div>
        </nav>

        <div class="container">
            <!-- 대시보드 컨텐츠 -->
            <div id="dashboard-content" class="content active">
                <h2>📊 대시보드</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">📋</div>
                        <div class="stat-info">
                            <div class="stat-value" id="total-licenses">-</div>
                            <div class="stat-label">총 라이선스</div>
                        </div>
                    </div>
                    <div class="stat-card success">
                        <div class="stat-icon">✅</div>
                        <div class="stat-info">
                            <div class="stat-value" id="active-licenses">-</div>
                            <div class="stat-label">활성 라이선스</div>
                        </div>
                    </div>
                    <div class="stat-card warning">
                        <div class="stat-icon">⏰</div>
                        <div class="stat-info">
                            <div class="stat-value" id="expired-licenses">-</div>
                            <div class="stat-label">만료된 라이선스</div>
                        </div>
                    </div>
                    <div class="stat-card info">
                        <div class="stat-icon">💻</div>
                        <div class="stat-info">
                            <div class="stat-value" id="total-devices">-</div>
                            <div class="stat-label">활성 디바이스</div>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h3>최근 활동</h3>
                    <div style="display:flex; gap:8px; align-items:center; margin: 8px 0 12px;">
                        <select id="activities-type" class="browser-default" style="max-width: 160px;">
                            <option value="">전체</option>
                            <option value="device">디바이스</option>
                            <option value="admin">관리자</option>
                        </select>
                        <input id="activities-action" placeholder="액션 필터 (예: validated, login)" style="flex:1;"/>
                        <input id="activities-limit" type="number" min="1" max="100" value="20" style="width:90px;"/>
                        <button id="activities-apply" class="btn btn-small grey lighten-1">적용</button>
                    </div>
                    <div id="recent-activities" class="activity-list">
                        <div class="loading">로딩 중...</div>
                    </div>
                </div>

                <div class="section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h3>디바이스 관리</h3>
                        <button id="cleanup-devices-btn" class="btn amber darken-1">🗑️ 비활성 디바이스 정리</button>
                    </div>
                    <p style="color: var(--secondary-color); font-size: 0.9rem;">
                        오래된 비활성 디바이스를 삭제하여 데이터베이스를 정리할 수 있습니다.
                    </p>
                </div>
            </div>

            <!-- 관리자 관리 컨텐츠 (슈퍼 관리자 전용) -->
            <div id="admins-content" class="content">
                <div class="page-header">
                    <h2>👥 관리자 관리</h2>
                    <button id="create-admin-btn" class="btn green">+ 서브 관리자 생성</button>
                </div>
                <div class="table-container">
                    <table class="striped highlight responsive-table">
                        <thead>
                            <tr>
                                <th>아이디/유저명</th>
                                <th>이메일</th>
                                <th>역할</th>
                                <th>권한</th>
                                <th>생성일</th>
                                <th>작업</th>
                            </tr>
                        </thead>
                        <tbody id="admins-tbody">
                            <tr><td colspan="6" class="text-center">로딩 중...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- 제품 관리 컨텐츠 -->
            <div id="products-content" class="content">
                <div class="page-header">
                    <h2>📦 제품 관리</h2>
                    <button id="create-product-btn" class="btn blue">+ 제품 생성</button>
                </div>

                <div class="table-container">
                    <table class="striped highlight responsive-table">
                        <thead>
                            <tr>
                                <th>제품명</th>
                                <th>설명</th>
                                <th>상태</th>
                                <th>생성일</th>
                                <th>작업</th>
                            </tr>
                        <tbody id="products-table">
                            <tr>
                                <td colspan="6" class="text-center">로딩 중...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- 라이선스 관리 컨텐츠 -->
            <div id="licenses-content" class="content">
                <div class="page-header">
                    <h2>🎫 라이선스 관리</h2>
                    <button id="create-license-btn" class="btn btn-primary">+ 새 라이선스</button>
                </div>

                <div class="search-bar">
                    <input type="text" id="search-input" placeholder="검색 (라이선스 키, 고객명, 이메일)">
                    <select id="status-filter" class="browser-default" style="max-width: 180px;">
                        <option value="">전체 상태</option>
                        <option value="active">활성</option>
                        <option value="expired">만료</option>
                        <option value="revoked">폐기</option>
                    </select>
                </div>

                <div id="licenses-table" class="table-container">
                    <table class="striped highlight responsive-table">
                        <thead>
                            <tr>
                                <th>라이선스 키</th>
                                <th>제품명</th>
                                <th>정책</th>
                                <th>고객명</th>
                                <th>최대 디바이스</th>
                                <th>만료일</th>
                                <th>상태</th>
                                <th>작업</th>
                            </tr>
                        </thead>
                        <tbody id="licenses-tbody">
                            <tr>
                                <td colspan="8" class="loading">로딩 중...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div id="pagination" class="pagination"></div>
            </div>

            <!-- 정책 관리 컨텐츠 -->
            <div id="policies-content" class="content">
                <div class="page-header">
                    <h2>🛡️ 정책 관리</h2>
                    <button id="create-policy-btn" class="btn blue" onclick="openCreatePolicyModal()">
                        <span class="btn-icon" aria-hidden="true"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg></span>새 정책 생성
                    </button>
                </div>

                <div class="table-container">
                    <table class="striped highlight responsive-table">
                        <thead>
                            <tr>
                                <th>정책명</th>
                                <th>생성/수정 시간</th>
                                <th>작업</th>
                            </tr>
                        </thead>
                        <tbody id="policies-tbody">
                            <tr><td colspan="4" class="text-center">정책을 불러오는 중...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- 파일 서버 컨텐츠 -->
            <div id="files-content" class="content">
                <div class="page-header">
                    <h2>📁 파일 서버</h2>
                    <button class="btn blue" id="upload-file-btn" onclick="openUploadFileModal()">
                        <span class="btn-icon" aria-hidden="true"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 16V4m0 0l-4 4m4-4l4 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M20 16v2a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg></span>파일 업로드
                    </button>
                </div>

                <div class="card">
                    <div class="card-content">
                        <form id="file-search-form" class="file-search-form" style="display:flex;flex-wrap:wrap;gap:12px;margin-bottom:16px;align-items:center;">
                            <div style="flex:1;min-width:200px;max-width:400px;width:100%;">
                                <input type="text" id="file-search-input" placeholder="파일명 또는 업로더 검색" style="width:100%;">
                            </div>
                            <div class="file-search-actions" style="display:flex;gap:8px;margin-left:8px;">
                                <button type="submit" class="btn grey lighten-1">검색</button>
                            </div>
                        </form>
                        <div class="table-container">
                            <table class="striped highlight responsive-table">
                                <thead>
                                    <tr>
                                        <th>파일</th>
                                        <th>업로더</th>
                                        <th>크기</th>
                                        <th>업로드 시간</th>
                                        <th>작업</th>
                                    </tr>
                                </thead>
                                <tbody id="files-tbody">
                                    <tr><td colspan="5" class="text-center">파일을 불러오는 중...</td></tr>
                                </tbody>
                            </table>
                        </div>
                        <div id="files-pagination" class="pagination" style="margin-top:16px;display:flex;flex-wrap:wrap;gap:8px;"></div>
                    </div>
                </div>
            </div>

            <!-- 클라이언트 로그 컨텐츠 -->
            <div id="client-logs-content" class="content">
                <div class="page-header">
                    <h2>📋 클라이언트 로그</h2>
                    <button class="btn red" onclick="openCleanupLogsModal()" style="margin-left: auto;">
                        <span class="btn-icon" aria-hidden="true"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6" stroke="currentColor" stroke-width="2"/><path d="M10 11v6M14 11v6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><path d="M9 6l1-2h4l1 2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg></span>로그 정리
                    </button>
                </div>

                <!-- 필터 영역 -->
                <div class="filter-box" style="background: #f5f5f5; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                    <div class="row" style="margin-bottom: 0;">
                        <div class="col s12 m3">
                            <label>라이선스 키</label>
                            <input type="text" id="filter-license-key" placeholder="전체">
                        </div>
                        <div class="col s12 m2">
                            <label>디바이스 ID</label>
                            <input type="text" id="filter-device-id" placeholder="전체">
                        </div>
                        <div class="col s12 m2">
                            <label>로그 레벨</label>
                            <select id="filter-level" class="browser-default">
                                <option value="">전체</option>
                                <option value="DEBUG">DEBUG</option>
                                <option value="INFO">INFO</option>
                                <option value="WARN">WARN</option>
                                <option value="ERROR">ERROR</option>
                                <option value="FATAL">FATAL</option>
                            </select>
                        </div>
                        <div class="col s12 m2">
                            <label>카테고리</label>
                            <select id="filter-category" class="browser-default">
                                <option value="">전체</option>
                                <option value="APP">APP</option>
                                <option value="SYSTEM">SYSTEM</option>
                                <option value="LICENSE">LICENSE</option>
                                <option value="NETWORK">NETWORK</option>
                                <option value="PLUGIN">PLUGIN</option>
                                <option value="OTHER">OTHER</option>
                            </select>
                        </div>
                        <div class="col s12 m3">
                            <label>&nbsp;</label>
                            <button class="btn blue" onclick="applyClientLogsFilter()" style="width: 100%;">
                                <span class="btn-icon" aria-hidden="true"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="11" cy="11" r="7" stroke="currentColor" stroke-width="2"/><path d="M20 20l-3.5-3.5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg></span>검색
                            </button>
                        </div>
                    </div>
                </div>

                <div class="table-container">
                    <table class="striped highlight responsive-table">
                        <thead>
                            <tr>
                                <th>시간</th>
                                <th>레벨</th>
                                <th>카테고리</th>
                                <th>라이선스 키</th>
                                <th>디바이스 ID</th>
                                <th>메시지</th>
                                <th>상세</th>
                            </tr>
                        </thead>
                        <tbody id="client-logs-tbody">
                            <tr>
                                <td colspan="7" class="loading">로딩 중...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div id="logs-pagination" class="pagination"></div>
            </div>

            <!-- Swagger 컨텐츠 -->
            <div id="swagger-content" class="content">
                <h2>📚 API 문서</h2>
                <iframe src="/swagger/index.html" style="width: 100%; height: calc(100vh - 200px); border: none;"></iframe>
            </div>
        </div>
    </div>

    <!-- 제품 생성/수정 모달 -->
    <div id="product-modal" class="modal studio-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="product-modal-title">새 제품 생성</h3>
                <button class="modal-close" aria-label="닫기" title="닫기">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                        <path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
            <form id="product-form">
                <div class="form-group">
                    <label for="product_name_input">제품명 *</label>
                    <input type="text" id="product_name_input" name="name" required>
                </div>
                <div class="form-group">
                    <label for="product_description">설명</label>
                    <textarea id="product_description" name="description" rows="3"></textarea>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn grey darken-1 modal-close">취소</button>
                    <button type="submit" class="btn blue">생성</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 라이선스 생성/수정 모달 -->
    <div id="license-modal" class="modal studio-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">새 라이선스 생성</h3>
                <button class="modal-close" aria-label="닫기" title="닫기">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                        <path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
            <form id="license-form">
                <div class="form-group">
                    <label for="product_select">제품 선택 *</label>
                    <select id="product_select" required class="browser-default">
                        <option value="" disabled selected>제품을 선택하세요</option>
                    </select>
                    <input type="hidden" id="product_id_hidden" name="product_id" />
                </div>
                <div class="form-group">
                    <label for="policy_select">정책 선택</label>
                    <select id="policy_select" name="policy_id" class="browser-default">
                        <option value="">정책을 선택하세요 (선택사항)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="customer_name">고객명 *</label>
                    <input type="text" id="customer_name" name="customer_name" required>
                </div>
                <div class="form-group">
                    <label for="customer_email">고객 이메일 *</label>
                    <input type="email" id="customer_email" name="customer_email" required>
                </div>
                <div class="form-group">
                    <label for="max_devices">최대 디바이스 수 *</label>
                    <input type="number" id="max_devices" name="max_devices" min="1" value="1" required>
                </div>
                <div class="form-group">
                    <label for="expires_at">만료일 *</label>
                    <input type="date" id="expires_at" name="expires_at" required>
                </div>
                <div class="form-group">
                    <label for="notes">메모</label>
                    <textarea id="notes" name="notes" rows="3"></textarea>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn grey darken-1 modal-close">취소</button>
                    <button type="submit" class="btn blue">생성</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 라이선스 상세 모달 -->
    <div id="license-detail-modal" class="modal studio-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>라이선스 상세</h3>
                <button class="modal-close" aria-label="닫기" title="닫기">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                        <path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
            <div id="license-detail-content" class="license-detail">
                <!-- JavaScript로 채움 -->
            </div>
        </div>
    </div>

    <!-- 라이선스 수정 모달 -->
    <div id="edit-license-modal" class="modal studio-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>✏️ 라이선스 수정</h3>
                <button class="modal-close" aria-label="닫기" title="닫기">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                        <path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
            <form id="edit-license-form">
                <input type="hidden" id="edit_license_id" name="license_id">
                <div class="form-group">
                    <label for="edit_product_name">제품명 *</label>
                    <input type="text" id="edit_product_name" name="product_name" required readonly style="background-color: #f5f5f5;">
                </div>
                <div class="form-group">
                    <label for="edit_policy_select">적용 정책</label>
                    <select id="edit_policy_select" name="policy_id" class="browser-default">
                        <option value="">정책 없음</option>
                    </select>
                    <small style="color: #6b7280;">정책을 변경하거나 제거할 수 있습니다.</small>
                </div>
                <div class="form-group">
                    <label for="edit_customer_name">고객명 *</label>
                    <input type="text" id="edit_customer_name" name="customer_name" required>
                </div>
                <div class="form-group">
                    <label for="edit_customer_email">고객 이메일 *</label>
                    <input type="email" id="edit_customer_email" name="customer_email" required>
                </div>
                <div class="form-group">
                    <label for="edit_max_devices">최대 디바이스 수 *</label>
                    <input type="number" id="edit_max_devices" name="max_devices" min="1" required>
                </div>
                <div class="form-group">
                    <label for="edit_expires_at">만료일 *</label>
                    <input type="date" id="edit_expires_at" name="expires_at" required>
                </div>
                <div class="form-group">
                    <label for="edit_notes">메모</label>
                    <textarea id="edit_notes" name="notes" rows="3"></textarea>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn grey darken-1 modal-close">취소</button>
                    <button type="submit" class="btn blue">저장</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 비밀번호 변경 모달 -->
    <div id="change-password-modal" class="modal studio-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>비밀번호 변경</h3>
                <button class="modal-close" aria-label="닫기" title="닫기">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                        <path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
            <form id="change-password-form">
                <div class="form-group">
                    <label for="current_password">현재 비밀번호</label>
                    <input type="password" id="current_password" name="old_password" required>
                </div>
                <div class="form-group">
                    <label for="new_password">새 비밀번호 (8자 이상)</label>
                    <input type="password" id="new_password" name="new_password" minlength="8" required>
                </div>
                <div class="form-group">
                    <label for="new_password_confirm">새 비밀번호 확인</label>
                    <input type="password" id="new_password_confirm" required>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn grey darken-1 modal-close">취소</button>
                    <button type="submit" class="btn blue">변경</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 공통 메시지/확인 모달 -->
    <div id="dialog-modal" class="modal studio-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="dialog-title">알림</h3>
                <button class="modal-close" aria-label="닫기" title="닫기">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                        <path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <p id="dialog-message">메시지</p>
            </div>
            <div class="modal-footer">
                <button type="button" id="dialog-cancel" class="btn grey darken-1" style="display:none;">취소</button>
                <button type="button" id="dialog-ok" class="btn blue">확인</button>
            </div>
        </div>
    </div>

    <!-- 디바이스 정리 모달 -->
    <div id="cleanup-modal" class="modal studio-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>🗑️ 비활성 디바이스 정리</h3>
                <button class="modal-close" aria-label="닫기" title="닫기">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                        <path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 1rem;">비활성화된 지 일정 기간이 지난 디바이스를 데이터베이스에서 삭제합니다.</p>
                <div class="form-group">
                    <label for="cleanup-days">삭제 기준 (일)</label>
                    <input type="number" id="cleanup-days" value="90" min="0" max="365" required style="max-width: 160px;">
                    <small style="color: var(--secondary-color);">비활성화된 지 위 기간(일)보다 오래된 디바이스만 삭제됩니다. (0 = 오늘 포함 전체)</small>
                </div>
                <div id="cleanup-preview" style="margin-top: 1rem; padding: 0.75rem; background: var(--bg-color); border-radius: 4px; display: none;">
                    <strong>예상 삭제 대상:</strong> <span id="cleanup-count">-</span>개 디바이스
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary modal-close">취소</button>
                <button type="button" id="cleanup-confirm-btn" class="btn btn-danger">삭제</button>
            </div>
        </div>
    </div>

    <!-- 서브 관리자 생성 모달 (슈퍼 전용) -->
    <div id="create-admin-modal" class="modal studio-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>서브 관리자 생성</h3>
                <button class="modal-close" aria-label="닫기" title="닫기">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                        <path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
            <form id="create-admin-form">
                <div class="form-group">
                    <label for="admin_username">아이디 *</label>
                    <input type="text" id="admin_username" name="username" minlength="3" required>
                </div>
                <div class="form-group">
                    <label for="admin_email">이메일 *</label>
                    <input type="email" id="admin_email" name="email" required>
                </div>
                <div class="form-group">
                    <label for="admin_password">비밀번호 (8자 이상) *</label>
                    <input type="password" id="admin_password" name="password" minlength="8" required>
                </div>
                <div class="form-group">
                    <label>권한 안내</label>
                    <p class="muted-text">계정은 권한 없이 생성됩니다. 생성 후 관리자 목록에서 기능 권한 및 리소스 권한을 수동으로 부여하세요.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn grey darken-1 modal-close">취소</button>
                    <button type="submit" class="btn green">생성</button>
                </div>
            </form>
    </div>
</div>

    <div id="manage-admin-permissions-modal" class="modal studio-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>관리자 권한 관리</h3>
                <button class="modal-close" aria-label="닫기" title="닫기">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                        <path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
            <form id="manage-admin-permissions-form">
                <input type="hidden" id="manage-admin-id">
                <div class="modal-body">
                    <div id="function-permission-pane" class="permission-pane is-active">
                        <p class="permission-modal-intro"><strong id="manage-admin-name"></strong> 관리자에게 부여할 기능 권한을 선택하세요.</p>
                        <div id="manage-admin-permissions" class="permission-grid"></div>
                    </div>

                    <div id="resource-permission-pane" class="permission-pane" hidden>
                        <div class="permission-modal-intro">
                            기능 권한으로 허용된 범위 안에서 접근 가능한 라이선스·정책·제품을 선택하세요.
                        </div>
                        <div class="resource-permissions" data-role="resource-permissions">
                            <div class="resource-permissions-intro">
                                <h4>리소스 권한 설정</h4>
                                <p>기능 권한에서 허용된 범위 안에서 접근 가능한 리소스를 선택하세요. 필요한 항목만 열어두면 관리가 더 안전해집니다.</p>
                                <p class="resource-permissions-intro-note">먼저 왼쪽 목록에서 리소스 종류를 선택한 뒤 허용 모드와 세부 항목을 지정하세요.</p>
                            </div>
                            <div class="resource-permissions-body">
                                <section class="resource-section">
                                    <header class="resource-section-header">
                                        <h5>리소스 종류</h5>
                                        <p>관리할 리소스를 선택하면 아래 설정이 갱신됩니다.</p>
                                    </header>
                                    <div class="resource-type-choices" data-role="resource-type-tabs"></div>
                                </section>
                                <section class="resource-section">
                                    <header class="resource-section-header">
                                        <h5>허용 범위</h5>
                                        <p>리소스 접근 범위를 모드로 선택하세요.</p>
                                    </header>
                                    <div class="resource-mode-list" data-role="resource-mode"></div>
                                </section>
                                <section class="resource-section">
                                    <header class="resource-section-header">
                                        <h5>세부 항목 선택</h5>
                                        <p>선택한 항목만 모드에서 사용할 검색과 체크박스입니다.</p>
                                    </header>
                                    <div class="resource-tools">
                                        <input type="search" class="resource-search-input" data-role="resource-search" placeholder="검색어를 입력하세요" />
                                        <button type="button" class="btn-small grey lighten-2 resource-refresh-btn" data-role="resource-refresh">새로고침</button>
                                    </div>
                                    <div class="resource-helper-callout" data-role="resource-helper"></div>
                                    <div class="resource-list-card">
                                        <div class="resource-list" data-role="resource-list">
                                            <div class="resource-empty">리소스 정보를 불러오는 중입니다...</div>
                                        </div>
                                    </div>
                                </section>
                                <section class="resource-section">
                                    <header class="resource-section-header">
                                        <h5>현재 설정 요약</h5>
                                        <p>모든 리소스의 권한 상태를 한눈에 확인하세요.</p>
                                    </header>
                                    <div class="resource-summary" data-role="resource-summary"></div>
                                </section>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn grey darken-1 modal-close">취소</button>
                    <button type="submit" class="btn blue">저장</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 파일 업로드 모달 -->
    <div id="upload-file-modal" class="modal studio-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>📁 파일 업로드</h3>
                <button class="modal-close" aria-label="닫기" title="닫기">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                        <path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
            <form id="upload-file-form" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="upload_file_input">파일 선택 *</label>
                    <input type="file" id="upload_file_input" name="file" required>
                </div>
                <div class="form-group">
                    <label for="upload_file_description">설명 (선택)</label>
                    <textarea id="upload_file_description" name="description" rows="3" placeholder="파일에 대한 설명을 입력하세요."></textarea>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn grey darken-1 modal-close">취소</button>
                    <button type="submit" class="btn blue">업로드</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 정책 생성 모달 -->
    <div id="create-policy-modal" class="modal studio-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>🛡️ 새 정책 생성</h3>
                <button class="modal-close" aria-label="닫기" title="닫기">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
                </button>
            </div>
            <form id="create-policy-form">
                <div class="form-group">
                    <label for="policy_name">정책명 *</label>
                    <input type="text" id="policy_name" name="policy_name" placeholder="예: 프리미엄 정책" required>
                </div>
                <div class="form-group">
                    <label for="policy_data">정책 데이터 *</label>
                    <div class="policy-editor" data-policy-editor="create" data-initial-mode="form">
                        <div class="editor-mode-toggle" role="group" aria-label="입력 방식 선택">
                            <button type="button" class="btn btn-small editor-mode-btn active" data-mode="form">폼 입력</button>
                            <button type="button" class="btn btn-small grey lighten-2 editor-mode-btn" data-mode="json">JSON 직접 입력</button>
                        </div>
                        <div class="policy-editor-form" id="create_policy_editor_form">
                            <div class="policy-field-list" id="create_policy_field_list"></div>
                            <button type="button" class="btn btn-small blue lighten-1 add-policy-field-btn" data-action="add-field">필드 추가</button>
                            <small style="display:block;margin-top:8px;color:#6b7280;">문자열/숫자/불리언 값만 입력할 수 있습니다. 중첩 구조는 JSON 직접 입력을 이용하세요.</small>
                        </div>
                        <div class="policy-editor-json" id="create_policy_editor_json" hidden>
                            <textarea id="policy_data" name="policy_data" rows="10" placeholder='{"feature": "enabled"}' style="font-family: monospace;"></textarea>
                            <small style="color: #6b7280;">유효한 JSON 형식으로 입력해주세요.</small>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn grey darken-1 modal-close">취소</button>
                    <button type="submit" class="btn blue">생성</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 정책 수정 모달 -->
    <div id="edit-policy-modal" class="modal studio-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>✏️ 정책 수정</h3>
                <button class="modal-close" aria-label="닫기" title="닫기">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                        <path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
            <form id="edit-policy-form">
                <input type="hidden" id="edit_policy_id" name="policy_id">
                <div class="form-group">
                    <label for="edit_policy_name">정책명 *</label>
                    <input type="text" id="edit_policy_name" name="policy_name" required>
                </div>
                <div class="form-group">
                    <label for="edit_policy_data">정책 데이터 *</label>
                    <div class="policy-editor" data-policy-editor="edit" data-initial-mode="form">
                        <div class="editor-mode-toggle" role="group" aria-label="입력 방식 선택">
                            <button type="button" class="btn btn-small editor-mode-btn active" data-mode="form">폼 입력</button>
                            <button type="button" class="btn btn-small grey lighten-2 editor-mode-btn" data-mode="json">JSON 직접 입력</button>
                        </div>
                        <div class="policy-editor-form" id="edit_policy_editor_form">
                            <div class="policy-field-list" id="edit_policy_field_list"></div>
                            <button type="button" class="btn btn-small blue lighten-1 add-policy-field-btn" data-action="add-field">필드 추가</button>
                            <small style="display:block;margin-top:8px;color:#6b7280;">문자열/숫자/불리언 값만 입력할 수 있습니다. 중첩 구조는 JSON 직접 입력을 이용하세요.</small>
                        </div>
                        <div class="policy-editor-json" id="edit_policy_editor_json" hidden>
                            <textarea id="edit_policy_data" name="policy_data" rows="12" style="font-family: monospace;"></textarea>
                            <small style="color: #6b7280;">유효한 JSON 형식으로 입력해주세요.</small>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn grey darken-1 modal-close">취소</button>
                    <button type="submit" class="btn blue">저장</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 정책 데이터 보기 모달 -->
    <div id="view-policy-data-modal" class="modal studio-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 data-role="policy-title">정책 데이터</h3>
                <button class="modal-close" aria-label="닫기" title="닫기">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                        <path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="policy-data-meta" data-role="policy-meta"></div>
                <pre class="policy-json-viewer" data-role="policy-json"></pre>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn grey darken-1 modal-close">닫기</button>
                <button type="button" class="btn blue" data-role="copy-json">JSON 복사</button>
            </div>
        </div>
    </div>

    <!-- 클라이언트 로그 상세 모달 -->
    <div id="log-detail-modal" class="modal studio-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>📋 로그 상세</h3>
                <button class="modal-close" aria-label="닫기" title="닫기">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                        <path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
            <div id="log-detail-content" class="modal-body" style="max-height: 70vh; overflow-y: auto;">
                <!-- JavaScript로 채움 -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn grey darken-1 modal-close">닫기</button>
            </div>
        </div>
    </div>

    <!-- 클라이언트 로그 정리 모달 -->
    <div id="cleanup-logs-modal" class="modal studio-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>🗑️ 로그 정리</h3>
                <button class="modal-close" aria-label="닫기" title="닫기">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                        <path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
            <form id="cleanup-logs-form">
                <div class="modal-body">
                    <p style="margin-bottom: 20px;">선택한 날짜 이전의 모든 클라이언트 로그를 삭제합니다.</p>
                    <div class="form-group">
                        <label for="cleanup_before_date">이전 날짜 *</label>
                        <input type="date" id="cleanup_before_date" name="before_date" required>
                        <small style="color: #6b7280;">이 날짜 이전의 로그가 삭제됩니다.</small>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn grey darken-1 modal-close">취소</button>
                    <button type="submit" class="btn red">삭제</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Materialize JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <!-- Disable legacy admins rendering (use modern SPA) -->
    <script>window.__legacyAdminsEnabled = false;</script>
    <script type="module" src="./js/main.js"></script>

    <!-- 글로벌 로딩 오버레이 -->
    <div id="global-loading" class="loading-overlay" style="display:none;">
        <div class="loading-content">
            <div class="spinner"></div>
            <div class="loading-text">불러오는 중...</div>
        </div>
    </div>
</body>
</html>
